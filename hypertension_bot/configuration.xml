<?xml version="1.0" encoding="utf-8" ?>
<Configuration>

	<!--DB connection-->
	<ConnectionString>Server=localhost;Database=hypertension_db;Port=5432;User Id=postgres;Password=password;</ConnectionString>
	<ConnectionType>POSTGRESQL</ConnectionType>

	<!--Bot settings-->
	<BotToken>5505039837:AAGceHkTc7OVOn4AmwZ5x_Ol_srrDNkf3rs</BotToken>
	<WitToken>TOL255PV5YN7NCIULDK7JQWV5MG72WP4</WitToken>

	<!-- Querys-->
	<InsertMeasures>
		INSERT INTO users."Measurement"(systolic, diastolic, datetime,"heartRate", "User_idUser")
		VALUES (@sistolic, @diastolic, NOW(),(@sistolic*@diastolic)*0.002,@id::text);
	</InsertMeasures>

	<InsertUser>
		INSERT INTO users."User"("idUser")
		VALUES (@id::text)
		ON CONFLICT ("idUser") DO UPDATE
		SET "idUser" = @id::text;
	</InsertUser>

	<LastInsert>
		SELECT
			CASE 
				WHEN extract(day from datetime::timestamp::date)::text IS NULL THEN 0::text
				ELSE extract(day from datetime::timestamp::date)::text
			END
		FROM users."Measurement"
		WHERE "User_idUser" = @id::text
		ORDER BY datetime asc 
		LIMIT 1
	</LastInsert>

	<CalculateAVG>
		
	</CalculateAVG>
	
	<!-- Campi -->
	<!--Valore massimo consentito per la sistolica, sopra questo valore il bot invierà un messaggio di allerta all'utente -->
	<ValoreMaxSi>180</ValoreMaxSi>
	
	<!--Valore massimo consentito per la diastolica, sopra questo valore il bot invierà un messaggio di allerta all'utente -->
	<ValoreMaxDi>110</ValoreMaxDi>

</Configuration>